{% extends "layout.html" %}
{% block title %}MLB HR Handicapper - Hitter Stats{% endblock %}

{% block content %}
<h1 id="page-title">Top 50 Home Run Hitters</h1>
<p id="page-subtitle">Displaying the top 50 hitters by home runs for the {{ season }} season, with today's matchups.</p>

{% if error_message %}
<div class="alert alert-warning">{{ error_message }}</div>
{% endif %}

<div id="hitters-container">
    <div class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p>Loading hitter data...</p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fetch hitter data from API
    fetch('/api/hitters')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('hitters-container');
            
            // Update page title and subtitle with actual date
            if (data.today_date) {
                const date = new Date(data.today_date + 'T12:00:00'); // Add time to avoid timezone issues
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const formattedDate = date.toLocaleDateString('en-US', options);
                document.getElementById('page-title').textContent = `Top 50 Home Run Hitters for ${formattedDate}`;
                document.getElementById('page-subtitle').textContent = `Displaying the top 50 hitters by home runs for the 2025 season, with matchups for ${formattedDate}.`;
            }
            
            // Clear loading indicator
            container.innerHTML = '';
            
            // Handle errors
            if (data.error) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'alert alert-warning';
                errorDiv.textContent = data.error;
                container.appendChild(errorDiv);
                return;
            }
            
            // Check if we have data
            if (!data.hitters_data || data.hitters_data.length === 0) {
                const noDataDiv = document.createElement('div');
                noDataDiv.className = 'alert alert-info';
                noDataDiv.textContent = 'No hitter data available.';
                container.appendChild(noDataDiv);
                return;
            }
            
            // Create table
            const table = document.createElement('table');
            table.className = 'table table-striped table-hover';
            
            // Add table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Player</th>
                    <th>Team</th>
                    <th>At-Bats</th>
                    <th>Home Runs</th>
                    <th>Today's Opponent</th>
                </tr>
            `;
            table.appendChild(thead);
            
            // Add table body
            const tbody = document.createElement('tbody');
            data.hitters_data.forEach(hitter => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${hitter.name}</td>
                    <td>${hitter.team}</td>
                    <td>${hitter.at_bats}</td>
                    <td>${hitter.home_runs}</td>
                    <td>${hitter.opponent_today}</td>
                `;
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            
            // Add table to container
            container.appendChild(table);
            
            // Add sorting functionality
            const headers = table.querySelectorAll('th');
            headers.forEach(function(header, index) {
                header.style.cursor = 'pointer';
                header.addEventListener('click', function() {
                    sortTable(table, index, header);
                });
            });
        })
        .catch(error => {
            console.error('Error fetching hitter data:', error);
            const container = document.getElementById('hitters-container');
            container.innerHTML = `
                <div class="alert alert-danger">
                    Error loading data. Please try again later.
                </div>
            `;
        });
        
    // Sorting function
    function sortTable(table, columnIndex, header) {
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        // Get current sort direction
        const isAscending = !header.classList.contains('asc');
        
        // Clear all headers classes
        table.querySelectorAll('th').forEach(th => {
            th.classList.remove('asc', 'desc');
        });
        
        // Set new sort direction
        header.classList.add(isAscending ? 'asc' : 'desc');
        
        // Sort rows
        rows.sort((a, b) => {
            let aValue = a.cells[columnIndex].textContent.trim();
            let bValue = b.cells[columnIndex].textContent.trim();
            
            // Try to convert to numbers if possible
            const aNum = parseFloat(aValue);
            const bNum = parseFloat(bValue);
            
            if (!isNaN(aNum) && !isNaN(bNum)) {
                return isAscending ? aNum - bNum : bNum - aNum;
            }
            
            // String comparison
            return isAscending ? 
                aValue.localeCompare(bValue) : 
                bValue.localeCompare(aValue);
        });
        
        // Remove existing rows
        while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
        }
        
        // Append sorted rows
        rows.forEach(row => tbody.appendChild(row));
    }
});
</script>
{% endblock %} 